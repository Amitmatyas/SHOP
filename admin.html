<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>החנות שלי - דף ניהול</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; }
        header nav ul { list-style: none; padding: 0; }
        header nav ul li { display: inline; margin-right: 10px; }
        .add-product-form, .orders-list, .edit-products-list { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .product-form-group { margin-bottom: 10px; }
        label { display: block; margin-bottom: 5px; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        .order-item, .edit-product-item { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .edit-product-item button { margin-left: 10px; }
    </style>
</head>
<body>
    <header>
        <h1>ניהול החנות</h1>
        <nav>
            <ul>
                <li><a href="index.html">חזרה לחנות</a></li>
                <li><a href="#" id="logout-link-admin">התנתקות</a></li>
            </ul>
        </nav>
    </header>

    <main class="admin-page">
        <section class="add-product-form">
            <h2>הוספת מוצר חדש</h2>
            <form id="add-product-form">
                <div class="product-form-group">
                    <label for="add-product-name">שם מוצר:</label>
                    <input type="text" id="add-product-name" required>
                </div>
                <div class="product-form-group">
                    <label for="add-product-description">תיאור מוצר:</label>
                    <textarea id="add-product-description"></textarea>
                </div>
                <div class="product-form-group">
                    <label for="add-product-price">מחיר:</label>
                    <input type="number" id="add-product-price" min="0" step="0.01" required>
                </div>
                <div class="product-form-group">
                    <label for="add-product-image-url">כתובת תמונה:</label>
                    <input type="text" id="add-product-image-url">
                </div>
                <button type="submit">הוספת מוצר</button>
                <p id="add-product-message"></p>
            </form>
        </section>

        <section class="edit-products-list">
            <h2>עריכת מוצרים</h2>
            <div id="edit-products-container">
                <!-- כאן יתווספו המוצרים לעריכה -->
            </div>
        </section>

        <section class="orders-list">
            <h2>רשימת הזמנות</h2>
            <div id="orders-container">
                <!-- כאן יתווספו ההזמנות -->
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 החנות שלי. כל הזכויות שמורות.</p>
    </footer>

    <script type="module">
        // קונפיגורציית Firebase שלך כאן
        const firebaseConfig = {
            apiKey: "AIzaSyBEJgBRrpw6b1VsSqKl81q1z8m2RiixEmM",
            authDomain: "shop-75354.firebaseapp.com",
            projectId: "shop-75354",
            storageBucket: "shop-75354.firebasestorage.app",
            messagingSenderId: "602207987151",
            appId: "1:602207987151:web:839140b4a430e004cedeba",
            measurementId: "G-SD5W9ZK0B2"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const logoutLink = document.getElementById('logout-link-admin');
        const addProductForm = document.getElementById('add-product-form');
        const addProductMessage = document.getElementById('add-product-message');

        logoutLink?.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                await signOut(auth);
                window.location.href = 'index.html'; // מוביל לדף ההתחברות
            } catch (error) {
                console.error('שגיאה בהתנתקות:', error);
            }
        });

        addProductForm?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = addProductForm['add-product-name'].value;
            const description = addProductForm['add-product-description'].value;
            const price = parseFloat(addProductForm['add-product-price'].value);
            const imageUrl = addProductForm['add-product-image-url'].value;

            try {
                await addDoc(collection(db, 'products'), {
                    name,
                    description,
                    price,
                    imageUrl
                });
                addProductMessage.textContent = 'המוצר נוסף בהצלחה!';
                addProductForm.reset();
            } catch (error) {
                console.error('שגיאה בהוספת מוצר:', error);
                addProductMessage.textContent = 'שגיאה בהוספת מוצר.';
            }
        });

        window.addEventListener('load', () => {
            onAuthStateChanged(auth, (user) => {
                if (!user) {
                    window.location.href = 'index.html';
                } else if (!user.email.endsWith("@titus-admin.co.il")) {
                    window.location.href = 'index.html';
                }
            });
        });
    </script>
</body>
</html>
